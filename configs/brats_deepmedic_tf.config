import "config_examples:brats_base.config"
from "config_examples:assets" import (
    "batch_iter/patch_3d_strat.config",
    "problem/segm.config"
)
from .deepmedic_tf import *

from functools import partial
import tensorflow as tf

from dpipe.tf.utils import softmax_cross_entropy, get_tf_optimizer
from dpipe.train.lr_policy import Decreasing

logits2pred = partial(tf.nn.softmax, dim=1)
logits2loss = softmax_cross_entropy
optimize = get_tf_optimizer(
    # lazy
    tf_optimizer_name="AdamOptimizer"
)

x_patch_sizes = [[25, 25, 25], [57, 57, 57]]
y_patch_size = [9, 9, 9]

batch_size = 2

n_epochs = 3
n_iters_per_epoch = 3

lr_policy = Decreasing(
    atol=0.01,
    lr_dec_mul=0.5,
    lr_init=0.1,
    patience=5,
    rtol=0.02,
)

predictor_x_patch_sizes = [[106, 106, 106], [138, 138, 138]]
predictor_y_patch_size = [90, 90, 90]
